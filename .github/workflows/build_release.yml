name: Create Release (Windows)

# [변경] 이제 커밋 메시지가 아니라, '태그'를 올리면 실행됩니다.
on:
  push:
    tags:
      - "v*" # v1.0, v0.0.1 등 v로 시작하는 모든 태그

permissions:
  contents: write # 릴리즈를 작성할 권한 부여

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
      
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      - name: Install dependencies
        run: flutter pub get
        
      - name: Enable Windows
        run: flutter config --enable-windows-desktop

      - name: Build Windows
        run: flutter build windows --release

      - name: Compress Windows Release
        run: Compress-Archive -Path build\windows\x64\runner\Release\* -DestinationPath uglian_windows.zip

      # [추가됨] 여기가 핵심! 릴리즈를 만들고 파일을 올립니다.
      - name: Create Release & Upload
        uses: softprops/action-gh-release@v1
        with:
          files: uglian_windows.zip # 올릴 파일 이름
          tag_name: ${{ github.ref_name }} # 태그 이름 (예: v1.0.0)
          name: Release ${{ github.ref_name }} # 릴리즈 제목
          draft: false # 초안이 아니라 바로 공개
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}